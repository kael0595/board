<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script>
    function IDCheck() {
        var username = $("#username").val();
        console.log(username);
        $.ajax({
            url: "/user/checkUsername",
            method: "POST",
            data: {username: username},
            success: function(response) {
               if(response == 0){
                alert("사용할 수 있는 아이디입니다.");
                } else {
                alert("중복된 아이디입니다. 아이디를 다시 입력해주세요.");
                }
            },
            error: function (xhr, status, error) {
                alert("에러입니다.");
            }
        });
    }

     function EmailCheck() {
        var email = $("#email").val();
        console.log(email);
        $.ajax({
            url: "/user/checkEmail",
            method: "POST",
            data: {email: email},
            success: function(response) {
               if(response == 0){
                alert("사용할 수 있는 이메일 주소입니다.");
                } else {
                alert("중복된 이메일 주소입니다. 이메일 주소를 다시 입력해주세요.");
                }
            },
            error: function (xhr, status, error) {
                alert("에러입니다.");
            }
        });
    }


    </script>
    <title>회원가입</title>
  </head>
  <body>
  <div layout:fragment="content" class="container my-3">
    <div class="my-3 border-bottom">
      <h4>회원가입</h4>
    </div>
    <form th:action="@{/user/join}" th:object="${userCreateForm}" method="post">
      <div th:replace="~{form_errors :: formErrorsFragment}"></div>
      <div class="mb-3">
        <label for="username" class="form-label">사용자 ID</label>
        <input type="text" name="username" id="username" th:field="*{username}" class="form-control">
        <button type="button" id="IDConfirmButton" onclick="IDCheck()">ID 중복확인</button>
      </div>
      <div class="mb-3">
        <label for="password1" class="form-label">비밀번호</label>
        <input type="password" id="password1" th:field="*{password1}" class="form-control">
      </div>
      <div class="mb-3">
        <label for="password2" class="form-label">비밀번호 확인</label>
        <input type="password" id="password2" th:field="*{password2}" class="form-control">
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">사용자 email</label>
        <input type="email" id="email" name="email" th:field="*{email}" class="form-control">
        <input type="button" value="Email 중복확인" id="EmailConfirmButton" th:onclick="EmailCheck()">
      </div>
      <button type="submit" onclick="sendMail()" class="btn btn-primary">회원가입</button>
    </form>
  </div>
  <script>
    function sendMail() {
    var email = $('#email').val();
    var username = $('#username').val();
    console.log(email);
    console.log(username);
    $.ajax({
        url: "/user/sendEmail",
        method: "POST",
        data: {email: email}, {username: username},
        success: function(response) {
              alert("회원가입에 성공하였습니다.");
          },
          error: function(xhr, status, error) {
              alert("회원가입에 실패했습니다.");
          }
        });
    }
  </script>
</body>
</html>
