<!DOCTYPE html>
<html layout:decorate="~{common/layout}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script>
    function IDCheck() {
        var username = $("#username").val();
        console.log(username);
        $.ajax({
            url: "/user/checkUsername",
            method: "POST",
            data: {username: username},
            success: function(response) {
               if(response == 0){
                alert("사용할 수 있는 아이디입니다.");
                } else {
                alert("중복된 아이디입니다. 아이디를 다시 입력해주세요.");
                }
            },
            error: function (xhr, status, error) {
                alert("에러입니다.");
            }
        });
    }

     function EmailCheck() {
        var email = $("#email").val();
        console.log(email);
        $.ajax({
            url: "/user/checkEmail",
            method: "POST",
            data: {email: email},
            success: function(response) {
               if(response == 0){
                alert("사용할 수 있는 이메일 주소입니다.");
                } else {
                alert("중복된 이메일 주소입니다. 이메일 주소를 다시 입력해주세요.");
                }
            },
            error: function (xhr, status, error) {
                alert("에러입니다.");
            }
        });
    }
    </script>
    <title>회원가입</title>
  </head>
  <body>
  <div layout:fragment="content" class="flex-1 flex items-center justify-center">
    <div class="max-w-2xl w-full px-4">
        <h1 class="mb-4">회원가입</h1>
    <form th:action="@{/user/join}" th:object="${userCreateForm}" method="post" class="flex flex-col gap-6">

      <div class="form-control" >
        <label class="label">
          <span class="label-text">사용자 ID </span>
        </label>
        <input type="text" name="username" id="username" maxlength="30" th:field="*{username}" class="input input-bordered" autofocus>
        <button type="button" class="btn btn-primary" id="IDConfirmButton" onclick="IDCheck()">ID 중복확인</button>
      </div>
      <div class="form-control">
        <label for="password1" class="label cursor-pointer">
          <span class="label-text">비밀번호 </span>
        </label>
        <input type="password" id="password1" th:field="*{password1}" class="input input-bordered" maxlength="30">
      </div>
      <div class="form-control">
        <label for="password1" class="label cursor-pointer">
          <span class="label-text">비밀번호 확인</span>
        </label>
        <input type="password" id="password2" th:field="*{password2}" class="input input-bordered" maxlength="30">
      </div>
      <div class="form-control">
        <label for="password1" class="label cursor-pointer">
          <span class="label-text">사용자 email</span>
        </label>
        <input type="email" id="email" name="email" th:field="*{email}" class="input input-bordered" maxlength="80">
        <button type="button" class="btn btn-block btn-primary gap-1" id="EmailConfirmButton" th:onclick="EmailCheck()">Email 중복확인</button>
      </div>
      <div class="form-control">
        <label class="label">
          <span class="label-text">프로필 사진</span>
        </label>
        <input type="file" accept="image/jpeg, image/png, image/gif" class="file-input file-input-bordered" name="profileImg">
      </div>
      <button type="submit" onclick="sendMail()" class="btn btn-primary">회원가입</button>
    </form>
    </div>
  </div>
  <script>
    function sendMail() {
    var email = $('#email').val();
    var username = $('#username').val();
    console.log(email);
    console.log(username);
    $.ajax({
        url: "/user/sendEmail",
        method: "POST",
        data: {email: email}, {username: username},
        success: function(response) {
              alert("회원가입에 성공하였습니다.");
          },
          error: function(xhr, status, error) {
              alert("회원가입에 실패했습니다.");
          }
        });
    }
  </script>
</body>
</html>
